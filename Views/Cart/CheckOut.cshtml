@model IEnumerable<HTNLShop.ViewModels.CartItems>
@{
    ViewData["Title"] = "CheckOut";
     Layout = "_LayoutMain";
}

    <div class="container-fluid py-5">
        <div class="container py-5">
            <h1 class="mb-4">Billing details</h1>
            @* <form action="#"> *@

            <form asp-action="CheckOut" asp-controller="Cart">
                @if (Model.Count() == 1)
                {
                    <input type="hidden" name="BuyNowProductId" value="@Model.First().ProductId" />
                }
                <div class="row g-5">
                    <div class="col-md-12 col-lg-6 col-xl-7">
                      
                        <div class="form-check my-3">
                            @* <input type="checkbox" class="form-check-input" id="GiongKhachHang" name="GiongKhachHang" value="false"> *@
                        <input type="checkbox" class="form-check-input" id="GiongKhachHang" name="GiongKhachHang" value="true">
                            <label class="form-check-label" for="GiongKhachHang">Giống thông tin khách hàng</label>
                        </div>

                        <div class="form-item">
                            <label class="form-label my-3">Người nhận hàng<sup>*</sup></label>
                            <input type="text" id="FullName" class="form-control" name="FullName" placeholder="Người nhận hàng">
                        </div>
                        <div class="form-item">
                            <label class="form-label my-3">Địa chỉ nhận hàng<sup>*</sup></label>
                            <input type="text" id="Address" class="form-control" name="Address" placeholder="Địa chỉ nhận hàng">
                        </div>
                        <div class="form-item">
                            <label class="form-label my-3">Điện thoại<sup>*</sup></label>
                            <input type="text" id="Phone" class="form-control" name="Phone" placeholder="Số điện thoại">
                        </div>

                        <hr>
                        <div class="form-check my-3">
                            <input class="form-check-input" type="checkbox" id="Address-1" name="Address" value="Address">
                            <label class="form-check-label" for="Address-1">Ship to a different address?</label>
                        </div>
                        <div class="form-item mt-2">
                            <textarea name="Notes" class="form-control" spellcheck="false" cols="30" rows="11" placeholder="Ghi chú"></textarea>
                        </div>
                    </div>
                    <div class="col-md-12 col-lg-6 col-xl-5">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">Products</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Quantity</th>
                                        <th scope="col">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model)
                                    {
                                        <tr>
                                            <th scope="row">
                                                <div class="d-flex align-items-center mt-2">
                                                    <img src="@item.Image" class="img-fluid rounded-circle" style="width: 90px; height: 90px;" alt="">
                                                </div>
                                            </th>
                                            <td class="py-5">@item.ProductName</td>
                                            <td class="py-5">@item.Price</td>
                                            <td class="py-5">@item.Quantity</td>
                                            <td class="py-5">@item.Pay</td>
                                        </tr>
                                    }
                                        <th scope="row">
                                        </th>
                                        <td class="py-5"></td>
                                        <td class="py-5"></td>
                                        <td class="py-5">
                                            <p class="mb-0 text-dark py-3">Tổng cộng</p>
                                        </td>
                                        <td class="py-5">
                                            <div class="py-3 border-bottom border-top">
                                        <p class="mb-0 text-dark">@Model.Sum(pr => pr.Pay)</p>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">
                                        </th>
                                        <td class="py-5">
                                            <p class="mb-0 text-dark py-4">Shipping</p>
                                        </td>
                                        <td colspan="3" class="py-5">
                                            <div class="form-check text-start">
                                                <input type="checkbox" class="form-check-input bg-primary border-0" id="Shipping-1" name="Shipping-1" value="Shipping" checked>
                                                <label class="form-check-label" for="Shipping-1">Free Shipping</label>
                                            </div>
                                       
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">
                                        </th>
                                        <td class="py-5">
                                            <p class="mb-0 text-dark text-uppercase py-3">Thành tiền:</p>
                                        </td>
                                        <td class="py-5"></td>
                                        <td class="py-5"></td>
                                        <td class="py-5">
                                            <div class="py-3 border-bottom border-top">
                                            <p class="mb-0 text-dark">@Model.Sum(pr => pr.Pay)</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="row g-4 text-center align-items-center justify-content-center pt-4">
                            <button type="submit" class="btn border-secondary py-3 px-4 text-uppercase w-100 text-primary">Đặt hàng</button>
                        </div> 
                    </div>
            </div>
                </form>
                
            @* </form> *@
        </div>
    </div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <script src="js/main.js"></script>
<script>
    $(document).ready(function () {
        // Lấy thông tin khách hàng an toàn hơn
        const customerData = {
            fullName: '@Html.Raw(ViewBag.Customer?.FullName ?? "")',
            address: '@Html.Raw(ViewBag.Customer?.Address ?? "")',
            phone: '@Html.Raw(ViewBag.Customer?.PhoneNumber ?? "")'
        };

        console.log("Customer Data:", customerData); // Debug để kiểm tra

        $("#GiongKhachHang").change(function () {
            if ($(this).is(":checked")) {
                // Điền thông tin khách hàng
                $("#FullName").val(customerData.fullName).prop("readonly", true);
                $("#Address").val(customerData.address).prop("readonly", true);
                $("#Phone").val(customerData.phone).prop("readonly", true);

                // Đặt giá trị checkbox
                $(this).prop("checked", true);
            } else {
                // Xóa thông tin
                $("#FullName").val("").prop("readonly", false);
                $("#Address").val("").prop("readonly", false);
                $("#Phone").val("").prop("readonly", false);
            }
        });

        // Trigger change nếu checkbox đã được check sẵn
        if ($("#GiongKhachHang").is(":checked")) {
            $("#GiongKhachHang").trigger("change");
        }
    });
</script>


